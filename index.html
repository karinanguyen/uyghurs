<html lang="en">
<head>
    <meta charset="UTF-8">     
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src = 'd3.js'></script>
    <script src = 'scroller.js'></script>
    <script src = 'sections.js'></script>   
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <title> On Uyghur's Silence </title> 
</head> 

<body>
    <div id="tooltip"></div> 
    <div id="graphic"> 
        <div id="sections"> 
            <section class="step">
                <div class="title"></div>
                <br><br> 
                <h1>Where, when, and how much has been reported on Uyghur's issue around the world?</h1> 
                <p>
                    [Intro] Does Chinese influence and diplomatic relations in countries around the globe affect media reports 
                    and mentions on a controversial Uyghursâ€™ issue? The story will explore number of "Uyghurs" mentions in media reports from 2017-2021 
                    from different countries. More about the methodology of data lifecycle analysis is below. <br><br>

                    [Backstory] Silence on Uyghurs issue from country's media might tell us a lot, especially if we see such pattern from certain countries and surface their diplomatic / economic relations with China.    
                    These visualizations show preliminary data explorations and uncover some interesting insights. More text here <br><br>

                    [Background on Uyghurs] Reports from Visual Investigations NYTimes x HRC, BBC, etc. <br><br>  
                    
                    [Directions here] If you ever want to find out more about a bubble, just hover over it and a tooltip should appear.<br><br>
                    
                    [Data was provided by Primer.ai + credits] 
                </p> 
                <div id="my_dataviz"></div>
            </section>
            <script>
            //   // first promise returns the dataset
            // const dataset = d3.csv("data/heatmap_data.csv").then(function(data)
            //     {return data;
            //     });
            // //this promise returns an array with lattitude and longitude
            // const coords = dataset.then(function(value) {
            //   return Promise.all(value.map(function(results){
            //   return [results.country, results.uyghur_count];
            //     }))});
            // //print the array
            // coords.then(function(data) {
            //     return d3.select("body").append("p").text(data);});
                // set the dimensions and margins of the graph

            
                var margin = {top: 80, right: 25, bottom: 30, left: 40},
                  width = 700 - margin.left - margin.right,
                  height = 700 - margin.top - margin.bottom;
                
                // append the svg object to the body of the page
                var svg = d3.select("#my_dataviz")
                .append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                .append("g")
                  .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");
                
                //Read the data
                d3.csv("data/heatmap_data.csv", function(data) {
                  //Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
                  //console.log(data.uyghur_count);
                //});

                var x_elements = d3.set(data.map(function( item ) { return item.country; } )).values(),
                    y_elements = d3.set(data.map(function( item ) { return item.year; } )).values(); 
                
                  // Build X scales and axis:
                  var x = d3.scaleBand()
                    .range([ 0, width ])
                    .domain(myGroups)
                    .padding(0.05);
                  svg.append("g")
                    .style("font-size", 15)
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).tickSize(0))
                    .select(".domain").remove()
                
                  // Build Y scales and axis:
                  var y = d3.scaleBand()
                    .range([ height, 0 ])
                    .domain(myVars)
                    .padding(0.05);
                  svg.append("g")
                    .style("font-size", 15)
                    .call(d3.axisLeft(y).tickSize(0))
                    .select(".domain").remove()
                
                  // Build color scale
                  var myColor = d3.scaleSequential()
                    .interpolator(d3.interpolateBuPu)
                    .domain([1,400])
                
                  // create a tooltip
                  var tooltip = d3.select("#my_dataviz")
                    .append("div")
                      .style("opacity", 0)
                      .attr("class", "tooltip")
                      .style("background-color", "white")
                      .style("border", "solid")
                      .style("border-width", "2px")
                      .style("border-radius", "5px")
                      .style("padding", "5px")
                      .style("position", "absolute")
                
                  // Three function that change the tooltip when user hover / move / leave a cell
                  var mouseover = function(d) {
                    tooltip
                      .style("opacity", 1)
                    d3.select(this)
                      .style("stroke", "black")
                      .style("opacity", 1)
                  }
                  var mousemove = function(d) {
                    tooltip
                      .html("The exact value of<br>this cell is: " + d.uyghur_count)
                      .style("left", (d3.event.pageX+20) + "px")
                      .style("top", (d3.event.pageY-30) + "px")
                  }
                  var mouseleave = function(d) {
                    tooltip
                      .style("opacity", 0)
                    d3.select(this)
                      .style("stroke", "none")
                      .style("opacity", 0.8)
                  }
                
                  // add the squares
                  svg.selectAll("rect")
                    .data(data, function(d) {return d.country+':'+d.year;})
                    .enter()
                    .append("rect")
                      .attr("x", function(d) { return x(d.country) })
                      .attr("y", function(d) { return y(d.year) })
                      .attr("rx", 4)
                      .attr("ry", 4)
                      .attr("width", x.bandwidth() )
                      .attr("height", y.bandwidth() )
                      .style("fill", function(d) { return myColor(d.uyghur_count)} )
                      .style("stroke-width", 4)
                      .style("stroke", "none")
                      .style("opacity", 0.8)
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave)
                })
                
                // Add title to graph
                svg.append("text")
                        .attr("x", 0)
                        .attr("y", -50)
                        .attr("text-anchor", "left")
                        .style("font-size", "22px")
                        .text("A d3.js heatmap");
                
                // Add subtitle to graph
                svg.append("text")
                        .attr("x", 0)
                        .attr("y", -20)
                        .attr("text-anchor", "left")
                        .style("font-size", "14px")
                        .style("fill", "grey")
                        .style("max-width", 400)
                        .text("A short description of the take-away message of this chart.");
                
                </script>
            <section class="step">
                <p>
                    [This text will change] Comparing to the source that list produced during the UN Human Rights Council and the U.N. High Commissioner for Human Rights (source) countries that are against / supporting China's policies and media mentions, 
                    we can see on this chart that both countries that are claimed to be against and support policies have lots of media mentions of Uyghurs. <br><br> 
                    
                    Since we don't have the sentiment of those mentions, this insight makes total sense. We can see more than 100 mentions from democracies and well-developed countries like UK, Belgium, France.  
                    Interestingly Taiwan, Hong Kong, Iran, Iraq, Russia is also on this chart, considering China's special relations with those countries. <br><br> 
                </p>
                <svg id = 'legend' width = '400px' height = '500px'></svg>
            </section>
            <section class="step">
                <p>
                    [This text will change] Comparing to the source that list produced during the UN Human Rights Council and the U.N. High Commissioner for Human Rights (source) countries that are against / supporting China's policies and media mentions, 
                    we can see on this chart that both countries that are claimed to be against and support policies have lots of media mentions of Uyghurs. <br><br> 
                    
                    Since we don't have the sentiment of those mentions, this insight makes total sense. We can see more than 100 mentions from democracies and well-developed countries like UK, Belgium, France.  
                    Interestingly Taiwan, Hong Kong, Iran, Iraq, Russia is also on this chart, considering China's special relations with those countries. <br><br> 
                </p>
                <svg id = 'legend' width = '400px' height = '500px'></svg>
            </section>

        </div>
        <div id="vis">

        </div>
    </div>
</body>
</html> 